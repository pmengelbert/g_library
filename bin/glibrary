#!/usr/bin/env ruby
require 'json'
require 'io/console'

require_relative '../modules/api_query'
require_relative '../modules/command_line_parse'
require_relative '../modules/errors'
require_relative '../modules/error_handler'
require_relative '../modules/exec_helper'
require_relative '../modules/google_api_url'
require_relative '../modules/user_prompt'

require_relative '../lib/book_search'
require_relative '../lib/user_book'
require_relative '../lib/user_library'

include ExecHelper
include UserPrompt
include ErrorHandler


process_args! # processes and modifies ARGV

filename = FileHelper.prepare(DEFAULT_FILENAME)
options = get_cli_options
library_mode = options.nil? #options will be nil if library mode selected

if library_mode

  with_library_mode_error_handling do
    user_library = UserLibrary.new(filename: filename)
    library_mode_user_prompt(user_library)
  end

else

  with_search_mode_error_handling do
    @persistent_library = UserLibrary.new(filename: @filename)
    @temp_booklist = UserLibrary.new(nonpersistent: true)

    search_results = BookSearch.new(options)
    search_results.selected.each { |info| @temp_booklist.add(UserBook.new(info)) }
    @temp_booklist.pretty_print

    search_mode_user_prompt
  end

end
